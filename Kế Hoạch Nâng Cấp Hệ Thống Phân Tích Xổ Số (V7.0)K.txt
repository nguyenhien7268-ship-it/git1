Kế Hoạch Nâng Cấp Hệ Thống Phân Tích Xổ Số (V7.0)Kế hoạch này được chia thành 3 Giai đoạn chính, bắt đầu từ việc củng cố nền tảng để tăng tính linh hoạt.Giai Đoạn 1: Tách Biệt Nền Tảng & Tăng Tính Linh Hoạt (Scalability Foundation)Mục tiêu: Giảm sự phụ thuộc lẫn nhau giữa các module, chuẩn bị cho việc thay đổi DB hoặc Logic AI dễ dàng hơn trong tương lai.Công việcChi tiết (File ảnh hưởng)Lợi ích cho Nâng cấp1.1. Tạo Lớp Data RepositoryTạo file logic/data_repository.py. Chuyển toàn bộ các hàm tải dữ liệu lớn (load_data_ai_from_db, get_all_managed_bridges,...) từ db_manager.py sang đây.Nếu sau này chuyển từ SQLite sang PostgreSQL, bạn chỉ cần sửa file data_repository.py, không ảnh hưởng đến ml_model.py hay backtester.py.1.2. Giảm Phụ thuộc Chéo LogicSửa logic/ml_model.py để ngừng import các file logic khác (ví dụ: bridges_v16, bridges_classic, backtester). Thay vào đó, lottery_service.py sẽ chịu trách nhiệm thu thập tất cả dữ liệu (features) và truyền vào ml_model.py.Loại bỏ sự ghép nối cứng (hard coupling) giữa các module, giúp bạn có thể thay đổi/thử nghiệm mô hình AI mới mà không cần sửa các file logic cầu cũ.1.3. Áp dụng Multi-Threading (Giảm UI Freeze)Áp dụng thư viện threading của Python trong lottery_service.py cho các tác vụ nặng như Huấn luyện AI (train_ai_model) và Backtest toàn bộ lịch sử.Cải thiện UI/UX ngay lập tức. Ngăn chặn giao diện Tkinter bị đóng băng (freeze) khi thực hiện các tác vụ tốn thời gian, là bước đệm cho việc mở rộng tính năng.Giai Đoạn 2: Tăng Cường Độ Chính Xác AI (Prediction Power)Mục tiêu: Tăng cường đặc trưng đầu vào (Features) cho mô hình AI bằng cách sử dụng các chỉ số Chất lượng Cầu đã có sẵn trong cơ sở dữ liệu.Công việcChi tiết (File ảnh hưởng)Lợi ích cho Dự đoán2.1. Thêm Đặc trưng Chất lượng Cầu (Q-Features)Sửa logic/ml_model.py để thêm 3-5 đặc trưng mới vào hàm prepare_training_data:1. Average_Win_Rate: Tỷ lệ thắng trung bình của các cầu đang dự đoán lô tô này.2. Min_K2N_Risk: Chuỗi thua Max K2N nhỏ nhất trong các cầu đó.3. Current_Lose_Streak: Chuỗi thua hiện tại của cầu đang dự đoán.Đây là điểm yếu cốt lõi cần khắc phục. Mô hình AI sẽ học được Chất lượng thay vì chỉ Số lượng cầu, giúp tăng đáng kể độ chính xác.2.2. Huấn luyện lại Mô hình V7.0Huấn luyện lại mô hình RandomForest (tạo file loto_model.joblib mới) với bộ đặc trưng đã được làm giàu (bao gồm 6 features cũ + Q-Features).Khai thác tối đa dữ liệu hiện có, tạo ra phiên bản mô hình dự đoán mạnh hơn.2.3. Thêm Tham số AI TuningThêm các tham số của RandomForest (ví dụ: AI_MAX_DEPTH, AI_N_ESTIMATORS) vào file config.json.Giảm hard-code. Cho phép bạn tinh chỉnh siêu tham số (hyperparameters) của AI thông qua giao diện ui_settings.py hoặc ui_optimizer.py để tìm ra cấu hình tốt nhất.Giai Đoạn 3: Tối Ưu Hóa Kết Hợp và Trọng Số (Scoring Optimization)Mục tiêu: Tích hợp kết quả AI một cách liên tục và hiệu quả hơn vào Bảng Chấm Điểm Tổng Lực, đồng thời thử nghiệm mô hình ML tốt hơn.Công việcChi tiết (File ảnh hưởng)Lợi ích cho Lợi nhuận & Hiệu suất3.1. Chuyển sang Cộng điểm Trọng số Liên tụcSửa file logic/backtester.py (hàm get_top_scored_pairs):1. Loại bỏ logic kiểm tra ngưỡng AI_PROB_THRESHOLD.2. Áp dụng công thức cộng điểm theo trọng số: $$\text{Total\_Score} = \text{Score\_Truyền\_Thống} + (\text{AI\_Probability} \times \text{AI\_WEIGHT})$$Tối ưu hóa Bảng Chấm Điểm. Tích hợp kết quả AI một cách linh hoạt, nhạy bén hơn, thay vì chỉ là công tắc ON/OFF.3.2. Thêm Tham số Trọng số AIThêm tham số AI_SCORE_WEIGHT vào config.json và logic/config_manager.py.Cho phép bạn dễ dàng kiểm soát mức độ ảnh hưởng của AI lên điểm số cuối cùng, tối ưu hóa lợi nhuận.3.3. Thử nghiệm XGBoost/LightGBMCài đặt và thử nghiệm thay thế RandomForest bằng XGBoost (một mô hình Gradient Boosting) trong logic/ml_model.py (dạng thử nghiệm nội bộ).